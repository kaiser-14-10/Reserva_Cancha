{% extends 'base.html' %}
{% block title %}Reservar Cancha{% endblock %}
{% block content %}

<h2 class="mb-4">Reservar: {{ cancha.nombre }}</h2>

<style>
.dia {
    padding: 8px;
    display: inline-block;
    margin: 3px;
    border: 1px solid #ccc;
    border-radius: 6px;
    width: 40px;
    text-align: center;
    cursor: pointer;
}
.bloq { background: #ff4d4d; color: white; cursor:not-allowed; }
.pasado { opacity: 0.4; cursor:not-allowed; }
.limite { background: #ffaa2b; }
.selected { background: #198754; color: white; }
</style>

<h5>DÃ­as del mes</h5>

<div class="mb-3">
    {% for d in dias_mes %}
        <div class="dia
            {% if d.bloqueado %}bloq{% endif %}
            {% if d.pasado %}pasado{% endif %}
            {% if d.fuera_limite %}limite{% endif %}"
            
            data-fecha="{{ d.fecha|date:'Y-m-d' }}"
        >
            {{ d.fecha.day }}
        </div>
    {% endfor %}
</div>

{% if error %}
<div class="alert alert-danger">{{ error }}</div>
{% endif %}

<form method="post" class="card p-4 shadow-sm">
    {% csrf_token %}

    <div class="mb-3">
        <label class="form-label">Fecha seleccionada:</label>
        <input type="date" 
            name="fecha" 
            id="fecha_input" 
            class="form-control" 
            required 
            onkeydown="return false"
        >
    </div>

    <div class="mb-3">
        <label class="form-label">Hora (intervalos de 30 min):</label>
        <select name="hora" class="form-control" required>
            {% for h in horas %}
                <option value="{{ h }}">{{ h }}</option>
            {% endfor %}
        </select>
    </div>

    <button type="submit" class="btn btn-success w-100">Confirmar reserva</button>
</form>

<a href="/" class="btn btn-link mt-3">Volver</a>

<script>
document.querySelectorAll(".dia").forEach(dia => {
    dia.addEventListener("click", () => {

        if (dia.classList.contains("bloq") ||
            dia.classList.contains("pasado")) {
            return;
        }

        document.querySelectorAll(".dia").forEach(d => d.classList.remove("selected"));

        dia.classList.add("selected");

        document.getElementById("fecha_input").value = dia.dataset.fecha;
    });
});
</script>

{% endblock %}
